<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫ –≥–µ–π–º–ø–∞—Å—Å–æ–≤ –ø–æ –Ω–∏–∫—É</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 2rem;
        }

        input,
        button {
            padding: 0.5rem;
            margin: 0.5rem 0;
        }

        .gp-line {
            display: flex;
            gap: 10px;
            margin: 4px 0;
            align-items: center;
            font-family: monospace;
        }

        .link-part,
        .price-part {
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 4px;
            user-select: none;
            white-space: nowrap;
        }

        .link-part:hover {
            background: #d0f0ff;
        }

        .price-part:hover {
            background: #ffdada;
        }

        .calc-section {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ccc;
        }

        pre {
            background: #f0f0f0;
            padding: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <!-- üî¢ –í—Å—Ç–∞–≤–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
    <div class="calc-section">
        <h2>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω—ã –≥–µ–π–º–ø–∞—Å—Å–∞</h2>
        <label for="num">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å:</label>
        <input type="number" id="num" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 700" min="1">

        <label for="balance">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Ä–æ–±—É–∫—Å–æ–≤ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ:</label>
        <input type="number" id="balance" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 10000" min="1" value="10000">

        <pre id="result">–û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞...</pre>
        <small>üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–µ—Ä—ã–π –±–ª–æ–∫, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</small>
    </div>

    <!-- üîç –ü–æ–∏—Å–∫ –≥–µ–π–º–ø–∞—Å—Å–æ–≤ -->
    <h2>üîç –ü–æ–∏—Å–∫ –≥–µ–π–º–ø–∞—Å—Å–æ–≤ –ø–æ –Ω–∏–∫—É</h2>
    <input id="nickname" placeholder="–ù–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: owl4221)">
    <button onclick="findGamepasses()">–ò—Å–∫–∞—Ç—å</button>

    <div id="output"></div>

    <script>
        // --- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ---
        const numInput = document.getElementById('num');
    const balanceInput = document.getElementById('balance');
    const resultEl = document.getElementById('result');

    function calculate() {
        const num = parseFloat(numInput.value);
        const balanceRobux = parseFloat(balanceInput.value);
        let msg = '';

        if (isNaN(num) || num <= 0 || isNaN(balanceRobux) || balanceRobux <= 0) {
            resultEl.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.';
            return;
        }

        const totalAmount = Math.ceil(num / 0.7); // —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å
        const fullCount = Math.floor(totalAmount / balanceRobux); // —Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –≥–µ–π–º–ø–∞—Å–æ–≤ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å
        const remainder = totalAmount % balanceRobux;

        if (totalAmount > balanceRobux) {
            const altCount = Math.ceil(totalAmount / balanceRobux);
            const altPrice = Math.ceil(totalAmount / altCount);

            msg += `–í–∞—Ä–∏–∞–Ω—Ç 1:\n–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É –≥–µ–π–º–ø–∞—Å–∞ = ${altPrice}, —è –∫—É–ø–ª—é –µ–≥–æ ${altCount} —Ä–∞–∑(–∞).\n\n`;

            if (remainder > 0 && fullCount > 0) {
                msg += `–í–∞—Ä–∏–∞–Ω—Ç 2:\n–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É –≥–µ–π–º–ø–∞—Å–∞ = ${balanceRobux}, —è –∫—É–ø–ª—é –µ–≥–æ ${fullCount} —Ä–∞–∑(–∞) –∏ –µ—â–µ –æ–¥–∏–Ω –≥–µ–π–º–ø–∞—Å –∑–∞ ${remainder}.\n\n`;
            }

            msg += `–û–±—â–∞—è —Å—É–º–º–∞: ${totalAmount}\n–í—ã –ø–æ–ª—É—á–∏—Ç–µ: ${Math.ceil(totalAmount * 0.7)}`;
        } else {
            msg = `–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É –≥–µ–π–º–ø–∞—Å–∞ = ${totalAmount}`;
        }

        resultEl.textContent = msg;
    }

    numInput.addEventListener('input', calculate);
    balanceInput.addEventListener('input', calculate);

    resultEl.addEventListener('click', () => {
        const text = resultEl.textContent.trim();
        if (text && text !== '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.') {
            navigator.clipboard.writeText(text)
                .then(() => console.log('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ:\n' + text))
                .catch(err => console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err));
        }
    });

        // --- –ü–æ–∏—Å–∫ –≥–µ–π–º–ø–∞—Å—Å–æ–≤ ---
        async function findGamepasses() {
            const nickname = document.getElementById('nickname').value.trim();
            const res = await fetch('/find-gamepasses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nickname })
            });

            const output = document.getElementById('output');
            output.innerHTML = '';

            if (!res.ok) {
                output.textContent = await res.text();
                return;
            }

            const data = await res.json();
            if (!data.result.length) {
                output.textContent = '‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
                return;
            }

            // –µ—Å–ª–∏ —ç—Ç–æ –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
            if (data.result.length === 1 && data.result[0].includes('/passes/create')) {
                const link = data.result[0];

                const container = document.createElement('div');
                container.className = 'gp-line';

                const linkEl = document.createElement('a');
                linkEl.className = 'link-part';
                linkEl.textContent = '–°–æ–∑–¥–∞—Ç—å –≥–µ–π–º–ø–∞—Å—Å';
                linkEl.href = link;
                linkEl.target = '_blank';
                linkEl.rel = 'noopener noreferrer';

                linkEl.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    const message = `–°–æ–∑–¥–∞–π—Ç–µ –≥–µ–π–º–ø–∞—Å –ø–æ —Å—Å—ã–ª–∫–µ:\n${link}`;
                    navigator.clipboard.writeText(message);
                    linkEl.style.background = '#bdf5ff';
                });


                container.appendChild(linkEl);
                output.appendChild(container);
                return;
            }


            data.result.forEach(line => {
                const parts = line.split('\n').map(part => part.trim()).filter(Boolean);
                if (parts.length < 2) return;

                const link1Raw = parts[0];
                const link2Raw = parts[1];
                const priceMatch = link1Raw.match(/‚Äì\s*(\d+)\s*R\$?/);
                const price = priceMatch ? priceMatch[1] : '0';
                const cleanLink1 = link1Raw.split('‚Äì')[0].trim();

                const container = document.createElement('div');
                container.className = 'gp-line';

                const link1El = document.createElement('a');
                link1El.className = 'link-part';
                link1El.textContent = cleanLink1;
                link1El.href = cleanLink1;
                link1El.target = '_blank';
                link1El.rel = 'noopener noreferrer';
                link1El.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    navigator.clipboard.writeText(cleanLink1);
                    link1El.style.background = '#bdf5ff';
                });

                const priceEl = document.createElement('span');
                priceEl.className = 'price-part';
                priceEl.textContent = `${price}R$`;
                priceEl.addEventListener('click', () => {
                    navigator.clipboard.writeText(price);
                    priceEl.style.background = '#ffd6d6';
                });
                priceEl.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    navigator.clipboard.writeText(price);
                    priceEl.style.background = '#ffd6d6';
                });

                const link2El = document.createElement('a');
                link2El.className = 'link-part';
                link2El.textContent = link2Raw;
                link2El.href = link2Raw;
                link2El.target = '_blank';
                link2El.rel = 'noopener noreferrer';
                link2El.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    navigator.clipboard.writeText(link2Raw);
                    link2El.style.background = '#bdf5ff';
                });

                container.appendChild(link1El);
                container.appendChild(document.createTextNode(' ‚Äì '));
                container.appendChild(priceEl);
                container.appendChild(document.createElement('br'));
                container.appendChild(link2El);

                output.appendChild(container);
            });
        }
    </script>
</body>

</html>